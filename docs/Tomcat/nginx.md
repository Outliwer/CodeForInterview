## `nginx`的原理
* **代理**
    * 反向代理
    
        * **代理服务器**接受来自**客户端**的请求，然后将请求**转发**到内部网络的服务器，将服务器得到的**结果**返回给客户端
        
        * 使用`tomcat`访问一个`http://www.test.com/readme`，如果服务器中不存在`readme`，将会返回`Not Found`。但是利用**反向代理**可以完成从其他服务器上调用
    * 正向代理 
        * 代理`VPN`即可，起一个跳板作用 
* **工作流程**
    * 用户**访问**反向代理服务器 
    * 反向代理服务器**接受**用户的请求
    
    * 反向代理服务器在**本地缓存**中查找请求的内容
    * 如果不在**缓存**中，则会代替用户向原服务器**请求**相同的信息内容
    * 工作的**流程图**如下所示：
    
        ![](https://lh3.googleusercontent.com/-9qOAanhY5P0/W-7D-v-JAoI/AAAAAAAAABk/dNzlsx4wjYwc_GH_4279pJM82SgPadU4ACHMYCw/I/15423743895195.jpg)


    
* **模块**
    * 核心模块
    
        * 建立`nginx`服务模型、管理网络层和应用层协议、以及启动针对特定应用的一系列候选模块 
        
        * 当`nginx`发送文件或者转发请求到其他服务器，由**处理模块**或**代理类模块**提供服务
        * 当需要`nginx`把输出压缩或者在服务端增加一些东西，由**过滤模块**提供服务
    * 处理器模块
        * 直接处理请求，并进行输出内容和修改`headers`信息等操作
    * 过滤器模块
        * 类似于`rpc`框架中进行过滤的模块，其他处理器模块输出的内容进行修改操作，最后由`nginx`输出。
    * 代理类模块 
        * 这些模块主要与后端一些服务比如`FastCGI`等进行交互，实现服务代理和负载均衡等功能
* 对于**请求**的处理

    * 运行**模式**：多进程`+`异步非阻塞`IO`事件
        * `master`通过`nginx.conf`文件进行配置、`worker`进行连接和请求的**处理**
    
        ![](https://lh3.googleusercontent.com/-XKa5xihqMqg/W-7HBDA10PI/AAAAAAAAAB0/Pb3dCnypq78wQrlLgjqAZEInI9h3jryLgCHMYCw/I/15423751701401.jpg)

    * **热部署**实现
        * 修改配置文件`nginx.conf`后，重新生成新的`worker`进程，当然会以新的配置进行处理请求，而且新的请求必须都交给新的`worker`进程，至于老的`worker`进程，等把那些以前的请求处理完毕后，`kill`掉即可
    * **高并发**处理
        * `epoll`模型
    * **高可用**实现
        * 虚拟`ip` 
* 为什么要用`nginx + Tomcat`：保证同一个域名下可以进行多个`Tomcat`实例的部署

